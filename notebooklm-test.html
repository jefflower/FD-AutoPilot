<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NotebookLM API æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      margin-bottom: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 32px;
    }

    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f7fafc;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .section h2 {
      margin-bottom: 15px;
      color: #2d3748;
      font-size: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #4a5568;
      font-size: 14px;
    }

    input,
    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #edf2f7;
      color: #4a5568;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
      box-shadow: none;
    }

    .response {
      margin-top: 20px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      white-space: pre-wrap;
      font-family: 'Monaco', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }

    .status.success {
      background: #c6f6d5;
      color: #22543d;
    }

    .status.error {
      background: #fed7d7;
      color: #742a2a;
    }

    .status.info {
      background: #bee3f8;
      color: #2c5282;
    }

    .instructions {
      background: #fff5f5;
      border-left-color: #f56565;
      margin-bottom: 20px;
    }

    .instructions code {
      background: #ffebee;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }

    .instructions ol {
      margin: 10px 0 10px 20px;
    }

    .instructions li {
      margin: 8px 0;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ¤– NotebookLM API æµ‹è¯•å·¥å…·</h1>

    <!-- ä½¿ç”¨è¯´æ˜ -->
    <div class="section instructions">
      <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>

      <div
        style="background: #e6fffa; border: 2px solid #38b2ac; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
        <h3 style="margin: 0 0 10px 0; color: #234e52;">ğŸš€ æ¨èæ–¹æ³•: è‡ªåŠ¨æå–é…ç½®</h3>
        <ol style="margin: 8px 0 12px 20px; line-height: 1.8;">
          <li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://notebooklm.google.com/notebook/7662c1de-8bba-4d54-b834-e38161f942f4"
              target="_blank">NotebookLMé¡µé¢</a> å¹¶ç™»å½•</li>
          <li>æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·,åˆ‡æ¢åˆ° <strong>Console</strong> æ ‡ç­¾</li>
          <li>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¤åˆ¶è‡ªåŠ¨æå–è„šæœ¬</li>
          <li>ç²˜è´´åˆ° Console ä¸­å¹¶æŒ‰ Enter</li>
          <li>åœ¨ NotebookLM ä¸­å‘é€ä»»æ„æ¶ˆæ¯</li>
          <li>è„šæœ¬ä¼šè‡ªåŠ¨æå–é…ç½®å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿!</li>
        </ol>
        <button onclick="copyExtractScript()"
          style="background: linear-gradient(135deg, #38b2ac 0%, #319795 100%); margin: 0;">
          ğŸ“‹ å¤åˆ¶è‡ªåŠ¨æå–è„šæœ¬
        </button>
      </div>

      <details style="margin-top: 15px;">
        <summary style="cursor: pointer; color: #4a5568; font-weight: 600; padding: 8px 0;">
          ğŸ“ æ‰‹åŠ¨æå–æ–¹æ³• (ç‚¹å‡»å±•å¼€)
        </summary>
        <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
          <li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://notebooklm.google.com/notebook/7662c1de-8bba-4d54-b834-e38161f942f4"
              target="_blank">NotebookLMé¡µé¢</a> å¹¶ç™»å½•</li>
          <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·(F12),åˆ‡æ¢åˆ° Network æ ‡ç­¾</li>
          <li>åœ¨NotebookLMä¸­å‘é€ä¸€æ¡æ¶ˆæ¯</li>
          <li>åœ¨Networkä¸­æ‰¾åˆ°åŒ…å« <code>stream</code> æˆ– <code>generate</code> çš„ POST è¯·æ±‚</li>
          <li>å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯å¹¶å¡«å…¥ä¸‹æ–¹è¡¨å•:
            <ul>
              <li><strong>Cookie</strong>: Request Headers â†’ Cookie</li>
              <li><strong>at Token</strong>: Request Payload â†’ at</li>
              <li><strong>f.sid</strong>: Query String Parameters â†’ f.sid</li>
            </ul>
          </li>
        </ol>
      </details>
    </div>

    <!-- é…ç½®åŒº -->
    <div class="section">
      <h2>âš™ï¸ é…ç½®ä¿¡æ¯</h2>

      <div class="form-group">
        <label>Cookie:</label>
        <textarea id="cookie" placeholder="ç²˜è´´å®Œæ•´çš„Cookieå­—ç¬¦ä¸²" rows="3"></textarea>
      </div>

      <div class="form-group">
        <label>AT Token:</label>
        <input type="text" id="atToken" placeholder="ç²˜è´´at tokenå€¼">
      </div>

      <div class="form-group">
        <label>F.SID:</label>
        <input type="text" id="fSid" placeholder="ç²˜è´´f.sidå€¼">
      </div>

      <div class="form-group">
        <label>Notebook ID:</label>
        <input type="text" id="notebookId" value="7662c1de-8bba-4d54-b834-e38161f942f4">
      </div>

      <button onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
      <button class="btn-secondary" onclick="loadConfig()">ğŸ“‚ åŠ è½½é…ç½®</button>
      <button class="btn-secondary" onclick="clearConfig()">ğŸ—‘ï¸ æ¸…é™¤é…ç½®</button>
    </div>

    <!-- æŸ¥è¯¢åŒº -->
    <div class="section">
      <h2>ğŸ’¬ å‘é€æŸ¥è¯¢</h2>

      <div class="form-group">
        <label>ä½ çš„é—®é¢˜:</label>
        <textarea id="query" placeholder="è¾“å…¥ä½ æƒ³é—®çš„é—®é¢˜..." rows="3"></textarea>
      </div>

      <button onclick="sendQuery(false)">ğŸš€ å‘é€æŸ¥è¯¢(éæµå¼)</button>
      <button onclick="sendQuery(true)">ğŸŒŠ å‘é€æŸ¥è¯¢(æµå¼)</button>

      <div id="status"></div>
      <div id="response" class="response" style="display:none;"></div>
    </div>

    <!-- æµ‹è¯•è¯´æ˜ -->
    <div class="section">
      <h2>ğŸ§ª æµ‹è¯•å»ºè®®</h2>
      <p>å»ºè®®çš„æµ‹è¯•é—®é¢˜:</p>
      <ul>
        <li>"è¿™äº›æ–‡æ¡£ä¸»è¦è®²ä»€ä¹ˆ?"</li>
        <li>"æ€»ç»“ä¸€ä¸‹ä¸»è¦å†…å®¹"</li>
        <li>"æœ‰å“ªäº›å¸¸è§çš„æ•…éšœæ’æŸ¥æ–¹æ³•?"</li>
      </ul>
    </div>
  </div>

  <script>
    // è‡ªåŠ¨æå–è„šæœ¬å†…å®¹
    const autoExtractScript = `/**
 * NotebookLM é…ç½®è‡ªåŠ¨æå–å·¥å…·
 * ä½¿ç”¨æ–¹æ³•: åœ¨ NotebookLM é¡µé¢çš„ Console ä¸­è¿è¡Œæ­¤è„šæœ¬,ç„¶åå‘é€ä¸€æ¡æ¶ˆæ¯
 */
(function() {
  console.log('%cğŸš€ NotebookLM é…ç½®è‡ªåŠ¨æå–å·¥å…·å·²å¯åŠ¨', 'color: #667eea; font-size: 16px; font-weight: bold;');
  console.log('%cè¯·åœ¨ NotebookLM ä¸­å‘é€ä¸€æ¡æ¶ˆæ¯...', 'color: #48bb78; font-size: 14px;');
  
  const extractedConfig = {
    cookie: document.cookie,
    atToken: null,
    fSid: null,
    notebookId: null,
    apiUrl: null
  };

  const urlMatch = window.location.pathname.match(/\\/notebook\\/([a-f0-9-]+)/);
  if (urlMatch) extractedConfig.notebookId = urlMatch[1];

  const originalXHROpen = XMLHttpRequest.prototype.open;
  const originalXHRSend = XMLHttpRequest.prototype.send;
  const originalFetch = window.fetch;

  XMLHttpRequest.prototype.open = function(method, url) {
    this._method = method;
    this._url = url;
    return originalXHROpen.apply(this, arguments);
  };

  XMLHttpRequest.prototype.send = function(data) {
    const url = this._url;
    if (this._method === 'POST' && url && (url.includes('stream') || url.includes('generate') || url.includes('orchestration'))) {
      console.log('%câœ… æ•è·åˆ°APIè¯·æ±‚!', 'color: #48bb78; font-weight: bold;');
      extractedConfig.apiUrl = url;
      try {
        const urlObj = new URL(url, window.location.origin);
        extractedConfig.fSid = urlObj.searchParams.get('f.sid');
        if (data) {
          const params = new URLSearchParams(data);
          extractedConfig.atToken = params.get('at');
        }
      } catch (e) {}
      setTimeout(() => displayConfig(), 500);
    }
    return originalXHRSend.apply(this, arguments);
  };

  window.fetch = async function(...args) {
    const [resource, config] = args;
    const url = typeof resource === 'string' ? resource : resource.url;
    if (config?.method === 'POST' && url && (url.includes('stream') || url.includes('generate') || url.includes('orchestration'))) {
      console.log('%câœ… æ•è·åˆ°APIè¯·æ±‚!', 'color: #48bb78; font-weight: bold;');
      extractedConfig.apiUrl = url;
      try {
        const urlObj = new URL(url, window.location.origin);
        extractedConfig.fSid = urlObj.searchParams.get('f.sid');
        if (config?.body) {
          const params = new URLSearchParams(config.body);
          extractedConfig.atToken = params.get('at');
        }
      } catch (e) {}
      setTimeout(() => displayConfig(), 500);
    }
    return originalFetch.apply(this, args);
  };

  function displayConfig() {
    console.clear();
    console.log('%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #667eea; font-weight: bold;');
    console.log('%cğŸ‰ é…ç½®ä¿¡æ¯æå–å®Œæˆ!', 'color: #48bb78; font-size: 18px; font-weight: bold;');
    console.log('%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #667eea; font-weight: bold;');
    
    const configJson = {
      notebookId: extractedConfig.notebookId,
      fSid: extractedConfig.fSid,
      atToken: extractedConfig.atToken,
      cookie: extractedConfig.cookie
    };
    
    console.log('');
    console.log('%cğŸ“‹ é…ç½®ä¿¡æ¯:', 'color: #4299e1; font-size: 14px; font-weight: bold;');
    console.log(JSON.stringify(configJson, null, 2));
    console.log('');
    
    navigator.clipboard.writeText(JSON.stringify(configJson, null, 2)).then(() => {
      console.log('%câœ… é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!', 'color: #48bb78; font-size: 14px; font-weight: bold;');
      console.log('%cğŸ’¡ ç°åœ¨å¯ä»¥ç²˜è´´åˆ°æµ‹è¯•å·¥å…·ä¸­ä½¿ç”¨äº†', 'color: #4299e1;');
    });
    
    window.NOTEBOOKLM_CONFIG = configJson;
    console.log('%cğŸ’¾ é…ç½®å·²ä¿å­˜åˆ°: window.NOTEBOOKLM_CONFIG', 'color: #805ad5;');
  }

  console.log('%câ³ ç­‰å¾…æ•è·APIè¯·æ±‚... è¯·åœ¨NotebookLMä¸­å‘é€ä¸€æ¡æ¶ˆæ¯', 'color: #4299e1;');
})();`;

    // å¤åˆ¶è‡ªåŠ¨æå–è„šæœ¬
    function copyExtractScript() {
      navigator.clipboard.writeText(autoExtractScript).then(() => {
        alert('âœ… è‡ªåŠ¨æå–è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!\\n\\nä¸‹ä¸€æ­¥:\\n1. æ‰“å¼€NotebookLMé¡µé¢\\n2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·\\n3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾\\n4. ç²˜è´´è„šæœ¬å¹¶æŒ‰Enter\\n5. åœ¨NotebookLMä¸­å‘é€ä¸€æ¡æ¶ˆæ¯');
      }).catch(err => {
        alert('å¤åˆ¶å¤±è´¥: ' + err);
      });
    }

    // ä¿å­˜é…ç½®åˆ°localStorage
    function saveConfig() {
      const config = {
        cookie: document.getElementById('cookie').value,
        atToken: document.getElementById('atToken').value,
        fSid: document.getElementById('fSid').value,
        notebookId: document.getElementById('notebookId').value
      };

      localStorage.setItem('notebooklm_test_config', JSON.stringify(config));
      showStatus('é…ç½®å·²ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨', 'success');
    }

    // ä»localStorageåŠ è½½é…ç½®
    function loadConfig() {
      const stored = localStorage.getItem('notebooklm_test_config');
      if (stored) {
        const config = JSON.parse(stored);
        document.getElementById('cookie').value = config.cookie || '';
        document.getElementById('atToken').value = config.atToken || '';
        document.getElementById('fSid').value = config.fSid || '';
        document.getElementById('notebookId').value = config.notebookId || '';
        showStatus('é…ç½®å·²åŠ è½½', 'success');
      } else {
        showStatus('æœªæ‰¾åˆ°ä¿å­˜çš„é…ç½®', 'info');
      }
    }

    // æ¸…é™¤é…ç½®
    function clearConfig() {
      localStorage.removeItem('notebooklm_test_config');
      document.getElementById('cookie').value = '';
      document.getElementById('atToken').value = '';
      document.getElementById('fSid').value = '';
      showStatus('é…ç½®å·²æ¸…é™¤', 'info');
    }

    // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.className = 'status ' + type;
      statusDiv.textContent = message;
      statusDiv.style.display = 'block';
    }

    // æ˜¾ç¤ºå“åº”
    function showResponse(text) {
      const responseDiv = document.getElementById('response');
      responseDiv.textContent = text;
      responseDiv.style.display = 'block';
    }

    // ç”ŸæˆUUID
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // æ„é€ è¯·æ±‚
    async function sendQuery(streaming = false) {
      const cookie = document.getElementById('cookie').value.trim();
      const atToken = document.getElementById('atToken').value.trim();
      const fSid = document.getElementById('fSid').value.trim();
      const notebookId = document.getElementById('notebookId').value.trim();
      const query = document.getElementById('query').value.trim();

      // éªŒè¯
      if (!cookie || !atToken || !fSid || !notebookId || !query) {
        showStatus('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ!', 'error');
        return;
      }

      // æ„é€ è¯·æ±‚
      const sessionUuid = generateUUID();
      const reqId = Math.floor(Math.random() * 900000) + 100000;

      const innerData = [
        [[]],  // æ–‡æ¡£IDæ•°ç»„,ç©ºè¡¨ç¤ºä½¿ç”¨æ‰€æœ‰æ–‡æ¡£
        query,
        null,
        [2, null, [1], [1]],
        sessionUuid,
        null, null, null, 1
      ];

      const fReqData = [null, JSON.stringify([innerData])];
      const fReq = JSON.stringify(fReqData);

      const url = `https://notebooklm.google.com/_/LabsTailwindUi/data/google.internal.labs.tailwind.orchestration.v1.LabsTailwindOrchestrationService/GenerateFreeFormStreamed?bl=boq_labs-tailwind-frontend_20260115.08_p0&_reqid=${reqId}&rt=c&f.sid=${fSid}`;

      const formData = new URLSearchParams({
        'f.req': fReq,
        'at': atToken
      });

      showStatus('æ­£åœ¨å‘é€è¯·æ±‚...', 'info');
      showResponse('');

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Cookie': cookie,
            'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8',
            'Referer': `https://notebooklm.google.com/notebook/${notebookId}`,
            'Origin': 'https://notebooklm.google.com'
          },
          body: formData.toString()
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        if (streaming) {
          showStatus('æ­£åœ¨æ¥æ”¶æµå¼å“åº”...', 'info');
          let fullText = '';
          const reader = response.body.getReader();
          const decoder = new TextDecoder();

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value, { stream: true });
            fullText += chunk + '\n---CHUNK---\n';
            showResponse(fullText);
          }

          showStatus('âœ… æµå¼å“åº”æ¥æ”¶å®Œæˆ', 'success');
        } else {
          const text = await response.text();
          showResponse(text);
          showStatus('âœ… å“åº”æ¥æ”¶å®Œæˆ', 'success');
        }

      } catch (error) {
        showStatus('âŒ é”™è¯¯: ' + error.message, 'error');
        console.error('è¯·æ±‚å¤±è´¥:', error);
      }
    }

    // é¡µé¢åŠ è½½æ—¶å°è¯•åŠ è½½é…ç½®
    window.addEventListener('load', () => {
      const stored = localStorage.getItem('notebooklm_test_config');
      if (stored) {
        loadConfig();
      }
    });
  </script>
</body>

</html>